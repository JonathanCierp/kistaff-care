(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{cd54:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",[n("q-card",{attrs:{flat:""}},[n("div",{staticClass:"content-wrapper"},[n("div",{staticClass:"main-content"},[n("q-card-section",[n("p",[e._v("\n            ðŸ‘‹ Afin de finaliser votre dossier et faire partie officiellement de nos effectifs,\n            merci de nous transmettre vos documentsðŸ‘‡\n          ")]),e.documentsSize<30?n("q-select",{attrs:{options:e.docTypes,label:this.$t("labels.doc_type")},on:{input:function(t){e.docTypeChanged(t)}},model:{value:e.docType,callback:function(t){e.docType=t},expression:"docType"}}):e._e(),e.docType?n("q-uploader",{ref:"docUpload",staticStyle:{width:"100%"},attrs:{"hide-upload-btn":"",label:e.docType},on:{added:e.docsAdded}}):e._e()],1),n("q-card-section",[n("q-table",{attrs:{"row-key":"Id",title:this.$t("labels.uploaded_documents"),columns:e.docColumns,"rows-per-page-options":[20],data:e.documents},scopedSlots:e._u([{key:"body-cell-action",fn:function(t){return[n("q-td",{attrs:{props:t}},[n("q-btn",{attrs:{"icon-right":"cloud_download","no-caps":"",flat:"",dense:""},on:{click:function(n){e.downloadDocument(e.documents.indexOf(t.row))}}}),n("q-btn",{attrs:{color:"danger","icon-right":"delete","no-caps":"",flat:"",dense:""},on:{click:function(n){e.deleteDocument(e.documents.indexOf(t.row))}}})],1)]}}])})],1)],1)])])],1)},i=[],a=(n("a481"),n("7f7f"),n("2b0e")),c=n("9e62f"),d={name:"Documents",mixins:[Object(c["b"])({service:"documents"})],computed:{documentsParams:function(){return{query:{$sort:{Id:-1}},paginate:!1}},documentsSize:function(){var e=0;return this.documents.forEach((function(t){e+=t.BodyLength})),e/1024/1024}},methods:{docTypeChanged:function(e){this.$refs.docUpload&&this.$refs.docUpload.reset()},docsAdded:function(e){var t=this;this.$q.loading.show();var n=new FileReader;n.onload=function(){var o=t.$store.state.auth.user,i=t.$FeathersVuex.api.Document,c=new i({Name:t.docType+"-"+e[0].name,ParentId:o.ContactId,ContentType:e[0].type,Description:t.docType,Body:n.result.replace(/^data:.+;base64,/,"")});c.save().then((function(e){t.docType=null,t.$q.loading.hide(),t.$q.notify({color:"positive",textColor:"white",icon:"check_circle_outline",message:t.$i18n.t("notification.documentSaved")})})).catch((function(e){t.docType=null,t.$q.loading.hide(),a["a"].config.errorHandler(e)}))},n.readAsDataURL(e[0])},deleteDocument:function(e){var t=this;this.$q.dialog({title:this.$i18n.t("messages.confirm"),message:this.$i18n.t("messages.delete_confirmation"),ok:this.$i18n.t("buttons.submit"),cancel:this.$i18n.t("buttons.cancel")}).onOk((function(){t.$q.loading.show();var n=t.documents[e];n.remove().then((function(e){t.$q.loading.hide()})).catch((function(e){t.$q.loading.hide(),a["a"].config.errorHandler(e)}))}))},downloadDocument:function(e){var t=this.$FeathersVuex.api.ContentFile;t.get(this.documents[e].Id).then((function(e){var t="data:"+e.ContentType+";base64,"+e.Body;fetch(t).then((function(e){return e.blob()})).then((function(t){var n=window.document.createElement("a");n.href=window.URL.createObjectURL(t,{type:e.ContentType}),n.download=e.Name,n.click()}))}))}},data:function(){return{docType:null,docTypes:["Carte d'identitÃ©","Justificatif de domicile","Casier judiciaire","Carte vitale","Vaccinations","RIB","CV","DiplÃ´me","Attestation ADELI","Carte professionnelle ONI","Attestation AFGSU"],docColumns:[{name:"Name",field:"Name",label:"Nom du document",align:"left",sortable:!0},{name:"action",label:"Action",field:"action"}]}}},s=d,r=n("2877"),l=Object(r["a"])(s,o,i,!1,null,null,null);t["default"]=l.exports}}]);